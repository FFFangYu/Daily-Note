### 比较

先说一下几种存储方式的区别：

| 特性         | cookie                                                       | localStorage                                                 | sessionStorage                                               | indexDB                                                      |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 数据生命周期 | 一般由服务器生成，可以设置过期时间                           | 除非被清理，否则一直存在                                     | 页面关闭就清理                                               | 除非不清理，否则一直存在                                     |
| 数据存储大小 | 每个Cookie不超过4K数据。每个网站不超过20个Cookie。所有网站的Cookie总和不超过300个。 | 5M                                                           | 5M                                                           | 无限                                                         |
| 与服务端通信 | 每次都会携带在header中，对于请求性能影响                     | 不参与                                                       | 不参与                                                       | 不参与                                                       |
| 应用场景     | 状态存储                                                     | 存储一些内容稳定的资源，比如官网logo、存储Base64格式的图片资源 | 1.可以用它对表单信息进行维护，将表单信息存储在里面，可以保证页面即使刷新也不会让之前的表单信息丢失。  2.可以用它存储本次浏览记录。如果关闭页面后不需要这些记录。 | 拥有（非关系型）数据库本身的特性，比如：支持事务，存储二进制。 |

从上表可以看到，**cookie** **已经不建议用于存储**。如果没有大量数据存储需求的话，可以使用 localStorage 和 sessionStorage 。**对于不怎么改变的数据尽量使用** **localStorage** **存储**，否则可以用 sessionStorage 存储。

### Cookie

对于 cookie 来说，我们还需要注意安全性。

|   属性    |                             作用                             |
| :-------: | :----------------------------------------------------------: |
|   value   | 如果用于保存用户登入状态，应该将该值加密，不使用明文的用户标识 |
| http-only |                不能通过JS访问cookie，减少XSS                 |
|  secure   |                只能在协议为https的请求中携带                 |
| same-site |      规定浏览器不能在跨域请求中携带cookie，减少CSRF攻击      |

Cookie用来做**状态存储**，它的**缺陷**有：

- 容量缺陷，只有4KB
- 性能缺陷，紧跟域名，不管域名下面的某一个地址需不需要这个Cookie，请求都会携带上完整的Cookie，这样随着请求数量的增多，会造成巨大的性能浪费。可以通过Domain和Path指定作用域来解决。
- 安全缺陷，由于Cookie以纯文本的形式在浏览器和服务器中传递，很容易被非法用户截获，然后进行一系列的篡改，在Cookie的有效期内重新发送给服务器，这是相当危险的。另外，在HttpOnly为false的情况下，Cookie信息能直接通过JS脚本来读取。



### 补充🍄

- localStorage存储满了会怎么样？
  - 存储不进去并会报错
  - 避免问题的办法：
    - 划分域名，各个域名的存储空间由各业务规划使用
    - 跨页面传数据，考虑使用单页面，采用url传数据
- localStorage存储内容超过5M怎么办？
  - 划分域名
- cookie可以不设置过期时间吗？设置过期时间有上限吗？
  - 有两种存储类型的Cookie：会话性与持久性。Expires属性缺省时，为会话性Cookie，仅保存在客户端内存中，并在用户关闭浏览器时失效。
  - 持久性Cookie会保存在用户的硬盘中，直至生存期到或用户直接在网页中单击“注销”等按钮结束会话时才会失效 。
  - 不设置Cookie的生存期，表示cookie为会话型，用户关闭浏览器就会失效。
  - 过期时间？先设置100年试试。
- cookie过期怎么办？
  - 服务器检查过期，会重定向